generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Organization {
  id                       String                   @id @default(uuid())
  name                     String
  slug                     String                   @unique
  logoUrl                  String?                  @map("logo_url")
  website                  String?
  phone                    String?
  address                  String?
  isActive                 Boolean                  @default(true) @map("is_active")
  createdAt                DateTime                 @default(now()) @map("created_at")
  updatedAt                DateTime                 @updatedAt @map("updated_at")
  planId                   Int?
  paystack_subaccount_code String?
  region                   organizations_region?    @default(KEN)
  stripe_connect_id        String?
  invites                  Invite[]
  listings                 Listing[]
  maintenanceRequests      MaintenanceRequest[]
  properties               Property[]               @relation("OrganizationToProperty")
  notaryRecords            BlockchainNotaryRecord[]
  dssDocuments             DssDocument[]
  dssParticipants          DssParticipant[]
  dssWorkflowTemplates     DssWorkflowTemplate[]
  financialEntities        FinancialEntity[]
  users                    OrganizationUser[]
  plan                     Plan?                    @relation(fields: [planId], references: [id])
  vendors                  Vendor[]

  // --- Payment Settlement (Landlord) ---
  region Region? @default(KEN)

  // Africa (Split Logic)
  paystackSubaccountCode String? @map("paystack_subaccount_code")

  // USA (Payout Logic)
  stripeConnectId String? @map("stripe_connect_id")

  @@index([planId], map: "organizations_planId_fkey")
  @@map("organizations")
}

model User {
  id                     String                   @id @default(uuid())
  email                  String                   @unique
  passwordHash           String                   @map("password_hash")
  firstName              String?                  @map("first_name")
  lastName               String?                  @map("last_name")
  phone                  String?                  @unique // E.164 format (e.g. +2547...)
  phoneVerified          DateTime? // Null = not verified
  avatarUrl              String?                  @map("avatar_url")
  status                 UserStatus               @default(ACTIVE)
  lastLoginAt            DateTime?                @map("last_login_at")
  createdAt              DateTime                 @default(now()) @map("created_at")
  updatedAt              DateTime                 @updatedAt @map("updated_at")
  emailVerified          DateTime?                @map("email_verified")
  verificationToken      String?                  @unique
  consentMarketing       Boolean                  @default(false) @map("consent_marketing")
  consentNotifications   Boolean                  @default(true) @map("consent_notifications")
  consentTransactional   Boolean                  @default(true) @map("consent_transactional")
  kyc_status             users_kyc_status         @default(PENDING)
  paystack_customer_code String?
  plaid_access_token     String?
  region                 users_region?            @default(KEN)
  stripe_customer_id     String?
  AgentInvite            AgentInvite[]
  sentInvites            Invite[]                 @relation("UserInvites")
  leases                 Lease[]
  listings               Listing[]
  passwordResetTokens    PasswordResetToken[]
  tenantApplications     Tenantapplication[]
  twoFactorEnabled       Boolean                  @default(false)
  dssParticipants        DssParticipant[]
  listingAuditEntries    ListingAuditEntry[]
  organizationUsers      OrganizationUser[]
  tenant_payment_methods tenant_payment_methods[]
  vendors                Vendor[]

  // Relation to OTPs
  otps Otp[]

  // --- Payment Profile (Tenant) ---
  region    Region?   @default(KEN) // Defaulting to KEN for our pilot
  KycStatus KycStatus @default(PENDING) @map("kyc_status")

  // USA Identifiers
  stripeCustomerId          String? @map("stripe_customer_id")
  plaidAccessTokenEncrypted String? @map("plaid_access_token") // App must encrypt/decrypt this

  // Africa Identifiers
  paystackCustomerCode String? @map("paystack_customer_code")

  // Payment methods
  paymentMethods TenantPaymentMethod[]

  @@map("users")
}

model TenantPaymentMethod {
  id                    String   @id @default(uuid())
  userId                String   @map("user_id")
  type                  String // 'ACH', 'CARD'
  plaidAccessToken      String?  @map("plaid_access_token") // Encrypted
  plaidAccountId        String?  @map("plaid_account_id")
  stripePaymentMethodId String   @map("stripe_payment_method_id")
  isDefault             Boolean  @default(false) @map("is_default")
  createdAt             DateTime @default(now()) @map("created_at")
  updatedAt             DateTime @updatedAt @map("updated_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("tenant_payment_methods")
}

model OrganizationUser {
  id                String                  @id @default(uuid())
  userId            String                  @map("user_id")
  organizationId    String                  @map("organization_id")
  role              organization_users_role
  createdAt         DateTime                @default(now()) @map("created_at")
  adminActions      AdminAction[]           @relation("AdminActionsByAdmin")
  targetActions     AdminAction[]           @relation("AdminActionsTarget")
  createdRequests   MaintenanceRequest[]    @relation("RequestCreator")
  managedProperties Property[]
  postedServices    ServiceMarketplace[]
  organization      Organization            @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  user              User                    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, organizationId])
  @@index([organizationId], map: "organization_users_organization_id_fkey")
  @@map("organization_users")
}

// New Table for 2FA Codes
model Otp {
  id        String   @id @default(uuid())
  code      String // The 6-digit code
  phone     String // The destination
  userId    String
  expiresAt DateTime
  type      OtpType  @default(TWO_FACTOR)
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([phone])
}

model Vendor {
  id                 String               @id @default(uuid())
  organizationId     String               @map("organization_id")
  userId             String               @map("user_id")
  companyName        String               @map("company_name")
  serviceType        String               @map("service_type")
  phone              String?
  email              String?
  isActive           Boolean              @default(true) @map("is_active")
  createdAt          DateTime             @default(now()) @map("created_at")
  updatedAt          DateTime             @updatedAt @map("updated_at")
  MaintenanceRequest MaintenanceRequest[]
  organization       Organization         @relation(fields: [organizationId], references: [id])
  user               User                 @relation(fields: [userId], references: [id])

  @@unique([organizationId, userId])
  @@index([userId], map: "vendors_user_id_fkey")
  @@map("vendors")
}

model Invite {
  id             String       @id @default(cuid())
  email          String
  token          String       @unique
  role           Invite_role
  organizationId String
  invitedById    String?
  expiresAt      DateTime
  accepted       Boolean      @default(false)
  createdAt      DateTime     @default(now())
  leaseId        String?      @db.VarChar(255)
  lease          Lease?       @relation("LeaseInvites", fields: [leaseId], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "FK_Invite_Lease")
  invitedBy      User?        @relation("UserInvites", fields: [invitedById], references: [id])
  organization   Organization @relation(fields: [organizationId], references: [id])

  @@index([organizationId])
  @@index([email])
  @@index([invitedById], map: "Invite_invitedById_fkey")
  @@index([leaseId], map: "idx_invite_leaseId")
}

model PasswordResetToken {
  id        String   @id @default(uuid())
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model FinancialEntity {
  id             String         @id @default(uuid())
  organizationId String         @map("organization_id")
  name           String
  taxIdEncrypted String?        @map("tax_id_encrypted")
  organization   Organization   @relation(fields: [organizationId], references: [id])
  accounts       Account[]
  journals       JournalEntry[]

  @@index([organizationId], map: "financial_entities_organization_id_fkey")
  @@map("financial_entities")
}

model Account {
  id           String          @id @default(uuid())
  entityId     String          @map("entity_id")
  code         String
  name         String
  type         AccountType
  isSystem     Boolean         @default(false)
  entity       FinancialEntity @relation(fields: [entityId], references: [id])
  journalLines JournalLine[]

  @@unique([entityId, code])
  @@map("gl_accounts")
}

model JournalEntry {
  id                 String              @id @default(uuid())
  entityId           String              @map("entity_id")
  transactionDate    DateTime            @map("transaction_date")
  postedAt           DateTime?           @map("posted_at")
  description        String
  reference          String?
  isLocked           Boolean             @default(false)
  maintenanceRequest MaintenanceRequest?
  entity             FinancialEntity     @relation(fields: [entityId], references: [id])
  lines              JournalLine[]
  invoice            Invoice?
  payment            Payment?
  utilityBill        UtilityBill?

  @@index([transactionDate])
  @@index([entityId], map: "gl_journal_entries_entity_id_fkey")
  @@map("gl_journal_entries")
}

model JournalLine {
  id             String       @id @default(uuid())
  journalEntryId String       @map("journal_entry_id")
  accountId      String       @map("account_id")
  description    String?
  debit          Decimal      @default(0.0000) @db.Decimal(20, 4)
  credit         Decimal      @default(0.0000) @db.Decimal(20, 4)
  propertyId     String?      @map("property_id")
  unitId         String?      @map("unit_id")
  leaseId        String?      @map("lease_id")
  tenantId       String?      @map("tenant_id")
  vendorId       String?      @map("vendor_id")
  account        Account      @relation(fields: [accountId], references: [id])
  journalEntry   JournalEntry @relation(fields: [journalEntryId], references: [id], onDelete: Cascade)
  lease          Lease?       @relation(fields: [leaseId], references: [id])
  property       Property?    @relation(fields: [propertyId], references: [id])
  unit           Unit?        @relation(fields: [unitId], references: [id])

  @@index([accountId])
  @@index([propertyId])
  @@index([journalEntryId], map: "gl_journal_lines_journal_entry_id_fkey")
  @@index([leaseId], map: "gl_journal_lines_lease_id_fkey")
  @@index([unitId], map: "gl_journal_lines_unit_id_fkey")
  @@map("gl_journal_lines")
}

model FinancialSnapshot {
  id           String   @id @default(uuid())
  entityId     String   @map("entity_id")
  periodStart  DateTime @map("period_start")
  periodEnd    DateTime @map("period_end")
  accountId    String   @map("account_id")
  startBalance Decimal  @db.Decimal(20, 4)
  netChange    Decimal  @db.Decimal(20, 4)
  endBalance   Decimal  @db.Decimal(20, 4)
  calculatedAt DateTime @default(now()) @map("calculated_at")

  @@unique([entityId, accountId, periodEnd])
  @@map("gl_financial_snapshots")
}

model UtilityBill {
  id             String              @id @default(uuid())
  propertyId     String              @map("property_id")
  providerName   String              @map("provider_name")
  totalAmount    Decimal             @db.Decimal(10, 2)
  billDate       DateTime            @map("bill_date")
  dueDate        DateTime            @map("due_date")
  importMethod   UtilityImportMethod @default(MANUAL_ENTRY) @map("import_method")
  ocrConfidence  Decimal?            @map("ocr_confidence") @db.Decimal(5, 2)
  status         UtilityBillStatus   @default(DRAFT)
  journalEntryId String?             @unique @map("journal_entry_id")
  blockchainHash String?             @map("blockchain_hash")
  createdAt      DateTime            @default(now()) @map("created_at")
  fileUrl        String?             @map("file_url")
  splitMethod    UtilitySplitMethod  @default(EQUAL) @map("split_method")
  updatedAt      DateTime            @updatedAt @map("updated_at")
  consumption    Float?              @db.Float
  periodEnd      DateTime?           @map("period_end")
  periodStart    DateTime?           @map("period_start")
  rate           Float?              @db.Float
  utilityId      String?             @map("utility_id") @db.Char(36)
  approvedAt     DateTime?           @map("approved_at")
  approvedBy     String?             @map("approved_by")
  rawOcrData     Json?               @map("raw_ocr_data")
  childInvoices  Invoice[]
  allocations    UtilityAllocation[]
  journalEntry   JournalEntry?       @relation(fields: [journalEntryId], references: [id])
  property       Property            @relation(fields: [propertyId], references: [id])
  utility        utility?            @relation(fields: [utilityId], references: [id])

  @@index([propertyId])
  @@index([utilityId])
  @@index([status])
  @@map("utility_bills")
}

model UtilityAllocation {
  id             String                  @id @default(uuid())
  utilityBillId  String                  @map("utility_bill_id")
  unitId         String                  @map("unit_id")
  amount         Decimal                 @db.Decimal(10, 2)
  invoiceId      String?                 @unique @map("invoice_id")
  percentage     Decimal?                @db.Decimal(5, 2)
  blockchainHash String?                 @map("blockchain_hash")
  createdAt      DateTime                @default(now())
  paidAmount     Decimal                 @default(0.00) @db.Decimal(10, 2)
  status         UtilityAllocationStatus @default(PENDING)
  tenantId       String?                 @map("tenant_id")
  leaseId        String?                 @map("lease_id")
  invoice        Invoice?                @relation(fields: [invoiceId], references: [id])
  lease          Lease?                  @relation(fields: [leaseId], references: [id])
  unit           Unit                    @relation(fields: [unitId], references: [id])
  utilityBill    UtilityBill             @relation(fields: [utilityBillId], references: [id], onDelete: Cascade)
  disputes       UtilityDispute[]
  payments       UtilityPayment[]

  @@index([utilityBillId])
  @@index([tenantId])
  @@index([leaseId])
  @@index([unitId], map: "utility_allocations_unit_id_fkey")
  @@map("utility_allocations")
}

model UtilityPayment {
  id                   String                      @id @default(uuid())
  allocationId         String                      @map("allocation_id")
  payerId              String                      @map("payer_id")
  amount               Decimal                     @db.Decimal(10, 2)
  method               UtilityPaymentMethod
  reference            String?
  status               String                      @default("COMPLETED")
  reconciliationStatus UtilityReconciliationStatus @default(PENDING) @map("reconciliation_status")
  blockchainHash       String?                     @map("blockchain_hash")
  createdAt            DateTime                    @default(now())
  allocation           UtilityAllocation           @relation(fields: [allocationId], references: [id])

  @@index([allocationId])
  @@map("utility_payments")
}

model UtilityDispute {
  id              String               @id @default(uuid())
  allocationId    String               @map("allocation_id")
  raisedBy        String               @map("raised_by")
  reason          String               @db.Text
  urgencyScore    Int?                 @default(1) @map("urgency_score")
  status          UtilityDisputeStatus @default(OPEN)
  resolutionNotes String?              @map("resolution_notes") @db.Text
  createdAt       DateTime             @default(now())
  resolvedAt      DateTime?            @map("resolved_at")
  allocation      UtilityAllocation    @relation(fields: [allocationId], references: [id])

  @@index([allocationId])
  @@map("utility_disputes")
}

model Property {
  id                     String                  @id @default(uuid())
  listingId              String?                 @unique
  managerId              String?
  organizationId         String?
  propertyTypeId         String?
  locationId             String?
  city                   String
  address                String
  amenities              String?
  isFurnished            Boolean                 @default(false)
  availabilityStatus     String?
  createdAt              DateTime                @default(now())
  name                   String?
  contactEmail           String?
  contactPhone           String?
  country                String?
  zipCode                String?
  latitude               Float?
  longitude              Float?
  apartmentComplexDetail ApartmentComplexDetail?
  CondoDetail            CondoDetail?
  houseDetail            HouseDetail?
  LandDetail             LandDetail?
  leases                 Lease[]
  maintenanceRequests    MaintenanceRequest[]    @relation("PropertyMaintenanceRequests")
  OccupancyHistory       OccupancyHistory[]
  listing                Listing?                @relation("PropertyListing", fields: [listingId], references: [id])
  location               Location?               @relation(fields: [locationId], references: [id])
  manager                OrganizationUser?       @relation(fields: [managerId], references: [id])
  organization           Organization?           @relation("OrganizationToProperty", fields: [organizationId], references: [id])
  propertyType           PropertyType?           @relation(fields: [propertyTypeId], references: [id])
  images                 PropertyImage[]
  tenantapplications     Tenantapplication[]
  townhouseDetail        TownhouseDetail?
  units                  Unit[]
  DssDocument            DssDocument[]
  DssWorkflowTemplate    DssWorkflowTemplate[]
  journalLines           JournalLine[]
  utilityBills           UtilityBill[]

  @@index([locationId])
  @@index([managerId])
  @@index([organizationId])
  @@index([propertyTypeId], map: "Property_propertyTypeId_fkey")
}

model PropertyImage {
  id         String   @id @default(uuid())
  propertyId String
  url        String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@index([propertyId])
}

model ApartmentComplexDetail {
  id           String   @id @default(uuid())
  propertyId   String   @unique
  buildingName String?
  totalFloors  Int?
  totalUnits   Int?
  bathrooms    Int?
  bedrooms     Int?
  size         Float?
  unitNumber   String?  @db.VarChar(50)
  zoning       String?
  property     Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
}

model HouseDetail {
  id             String   @id @default(uuid())
  propertyId     String   @unique
  numberOfFloors Int?
  bathrooms      Int?
  bedrooms       Int?
  size           Float?
  totalUnits     Int?
  houseName      String?  @db.VarChar(255)
  zoning         String?
  property       Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
}

model CondoDetail {
  id                    String   @id @default(uuid())
  propertyId            String   @unique
  buildingName          String?
  floorNumber           Int?
  unitNumber            String?
  totalFloorsInBuilding Int?
  bedrooms              Int?
  bathrooms             Int?
  size                  Float?
  hoaFees               Float?
  hasBalcony            Boolean  @default(false)
  amenities             Json?
  zoning                String?
  property              Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
}

model LandDetail {
  id           String   @id @default(uuid())
  propertyId   String   @unique
  lotSize      Float?
  zoning       String?
  isSubdivided Boolean  @default(false)
  hasUtilities Boolean  @default(false)
  topography   String?
  soilType     String?
  accessRoad   Boolean  @default(false)
  landUse      String?
  property     Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
}

model TownhouseDetail {
  id             String   @id @default(uuid())
  propertyId     String   @unique
  townhouseName  String?
  numberOfFloors Int?
  bedrooms       Int?
  bathrooms      Int?
  size           Float?
  unitNumber     String?
  endUnit        Boolean  @default(false)
  hasGarage      Boolean  @default(false)
  garageSpaces   Int?
  hasBackyard    Boolean  @default(false)
  backyardSize   Float?
  hoaFees        Float?
  zoning         String?
  property       Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
}

model Unit {
  id                  String               @id @default(uuid())
  propertyId          String
  complexDetailId     String?
  listingId           String?              @unique
  unitNumber          String
  floorNumber         Int?
  bedrooms            Int?
  bathrooms           Int?
  isOccupied          Boolean              @default(false)
  rentAmount          Float?
  createdAt           DateTime             @default(now())
  houseDetailId       String?
  unitName            String?
  currency            String?              @default("USD") @db.VarChar(10)
  squareFootage       Float?               @map("square_footage")
  leases              Lease[]
  maintenanceRequests MaintenanceRequest[]
  tenantApplications  Tenantapplication[]
  listing             Listing?             @relation("UnitListing", fields: [listingId], references: [id])
  property            Property             @relation(fields: [propertyId], references: [id])
  DssDocument         DssDocument[]
  journalLines        JournalLine[]
  listingAuditEntries ListingAuditEntry[]
  utilityAllocations  UtilityAllocation[]
  appliances          Appliance[]          @relation("UnitAppliances")

  @@index([propertyId])
}

model Appliance {
  id          String   @id @default(uuid())
  createdAt   DateTime @default(now())
  description String?
  name        String
  units       Unit[]   @relation("UnitAppliances")
}

model Tenantapplication {
  id                 String            @id @default(uuid())
  fullName           String
  email              String
  phone              String
  dob                DateTime
  ssn                String?
  ssnEncrypted       String?           @map("ssn_encrypted")
  address            String?
  employerName       String?
  jobTitle           String?
  monthlyIncome      Float?
  employmentDuration String?
  leaseType          String
  occupancyType      String
  moveInDate         DateTime
  leaseDuration      String
  occupants          Int?
  pets               String?
  landlordName       String?
  landlordContact    String?
  reasonForMoving    String?
  referenceName      String?
  referenceContact   String?
  consent            Boolean           @default(false)
  propertyId         String
  userId             String?
  status             ApplicationStatus @default(PENDING)
  createdAt          DateTime          @default(now())
  updatedAt          DateTime          @updatedAt
  unitId             String?
  tenantLeases       Lease?
  property           Property          @relation(fields: [propertyId], references: [id])
  unit               Unit?             @relation(fields: [unitId], references: [id])
  user               User?             @relation(fields: [userId], references: [id])

  @@index([propertyId])
  @@index([userId])
  @@index([unitId], map: "Tenantapplication_unitId_fkey")
}

model Lease {
  id                       String                  @id @default(uuid())
  applicationId            String                  @unique
  tenantId                 String?
  propertyId               String
  unitId                   String
  startDate                DateTime
  endDate                  DateTime
  rentAmount               Float
  securityDeposit          Float?
  leaseStatus              Lease_leaseStatus?      @default(DRAFT)
  createdAt                DateTime                @default(now())
  updatedAt                DateTime                @updatedAt
  earlyTerminationFee      Float?
  gracePeriodDays          Int?
  landlordResponsibilities String?
  landlordSignedAt         DateTime?
  lateFeeDaily             Float?
  lateFeeFlat              Float?
  leaseTerm                String?
  paymentDueDay            Int?
  paymentFrequency         String                  @default("MONTHLY")
  tenantPaysElectric       Boolean                 @default(true)
  tenantPaysInternet       Boolean                 @default(false)
  tenantPaysTrash          Boolean                 @default(false)
  tenantPaysWater          Boolean                 @default(false)
  tenantResponsibilities   String?
  usageType                String?
  hasRenewalOption         Boolean?                @default(false)
  renewalNoticeDays        Int?
  renewalTermMonths        Int?
  renewalRentIncrease      Float?
  autoRenew                Boolean?                @default(false)
  hasRentEscalation        Boolean?                @default(false)
  escalationType           Lease_escalationType?
  escalationRate           Float?
  escalationFrequency      String?                 @db.VarChar(20)
  nextEscalationDate       DateTime?               @db.DateTime(0)
  documentVersion          Int?                    @default(1)
  lastDocumentUpdate       DateTime?               @db.DateTime(0)
  complianceCheckDate      DateTime?               @db.DateTime(0)
  complianceStatus         Lease_complianceStatus? @default(PENDING)
  complianceNotes          String?                 @db.Text
  tenantSignedAt           DateTime?
  invites                  Invite[]                @relation("LeaseInvites")
  application              Tenantapplication       @relation(fields: [applicationId], references: [id])
  property                 Property                @relation(fields: [propertyId], references: [id])
  tenant                   User?                   @relation(fields: [tenantId], references: [id])
  unit                     Unit                    @relation(fields: [unitId], references: [id])
  LeaseAmendment           LeaseAmendment[]
  LeaseAuditLog            LeaseAuditLog[]
  LeaseDocument            LeaseDocument[]
  LeaseNotification        LeaseNotification[]
  LeaseRenewal             LeaseRenewal[]
  RentEscalation           RentEscalation[]
  dssDocuments             DssDocument[]
  journalLines             JournalLine[]
  invoices                 Invoice[]
  lease_utility            lease_utility[]
  utilityAllocations       UtilityAllocation[]

  @@index([propertyId])
  @@index([tenantId])
  @@index([unitId])
  @@index([endDate])
}

model Invoice {
  id                 String              @id @default(uuid())
  leaseId            String              @map("lease_id")
  type               invoice_type
  totalAmount        Float               @map("amount")
  amountPaid         Float               @default(0) @map("amount_paid")
  balance            Float               @default(0)
  dueDate            DateTime            @db.DateTime(0)
  status             invoice_status?     @default(PENDING)
  postingStatus      PostingStatus       @default(PENDING) @map("posting_status")
  journalEntryId     String?             @unique @map("journal_entry_id")
  utilityBillId      String?             @map("utility_bill_id")
  createdAt          DateTime?           @default(now()) @db.DateTime(0)
  updatedAt          DateTime?           @default(now()) @db.DateTime(0)
  InvoiceItem        InvoiceItem[]
  maintenanceRequest MaintenanceRequest?
  journalEntry       JournalEntry?       @relation(fields: [journalEntryId], references: [id])
  Lease              Lease               @relation(fields: [leaseId], references: [id], onDelete: Cascade)
  utilityBill        UtilityBill?        @relation(fields: [utilityBillId], references: [id])
  payments           Payment[]
  receipts           Receipt[]
  utilityAllocation  UtilityAllocation?

  @@index([leaseId], map: "invoice_lease_id_fkey")
  @@index([utilityBillId], map: "invoice_utility_bill_id_fkey")
  @@map("invoice")
}

model InvoiceItem {
  id          String    @id @default(uuid())
  invoiceId   String    @db.Char(36)
  description String    @db.VarChar(255)
  amount      Float
  createdAt   DateTime? @default(now()) @db.DateTime(0)
  updatedAt   DateTime? @default(now()) @db.DateTime(0)
  invoice     Invoice   @relation(fields: [invoiceId], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "InvoiceItem_ibfk_1")

  @@index([invoiceId], map: "invoiceId")
}

model Payment {
  id                String            @id @default(uuid())
  invoiceId         String            @map("invoice_id")
  amount            Decimal           @db.Decimal(10, 2)
  method            payment_method
  reference         String?           @db.VarChar(100)
  paidOn            DateTime?         @default(now()) @db.DateTime(0)
  postingStatus     PostingStatus     @default(PENDING) @map("posting_status")
  journalEntryId    String?           @unique @map("journal_entry_id")
  createdAt         DateTime?         @default(now()) @db.DateTime(0)
  updatedAt         DateTime?         @default(now()) @db.DateTime(0)
  isReversed        Boolean           @default(false) @map("is_reversed")
  reversedAt        DateTime?         @map("reversed_at") @db.DateTime(0)
  reversalReason    String?           @map("reversal_reason") @db.VarChar(255)
  reversedBy        String?           @map("reversed_by") @db.VarChar(100)
  amount_subunits   BigInt?
  currency          String            @default("KES") @db.VarChar(3)
  gateway           payment_gateway   @default(MANUAL)
  gateway_reference String?
  risk_score        Int?
  status            payment_status    @default(PENDING)
  type              payment_type      @default(RENT)
  metadata          Json?
  invoice           Invoice           @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  journalEntry      JournalEntry?     @relation(fields: [journalEntryId], references: [id])
  paymentReversals  PaymentReversal[]
  receipts          Receipt[]

  amountSubunits BigInt? @map("amount_subunits") // Cents(Integer math)
  currency       String  @default("KES") @db.VarChar(3)

  gateway          PaymentGateway @default(MANUAL)
  gatewayReference String?        @map("gateway_reference") //Stripe ID / Paystack Ref
  riskScore        Int?           @map("risk_score") // Plaid Signal Score
  metadata         Json? // Additional payment details (phone number, M-Pesa transaction details, etc.)

  // Status State Machine
  status TransactionStatus @default(PENDING)
  type   TransactionType   @default(RENT)

  @@index([gatewayReference])
  @@index([status])
  @@index([invoiceId])
  @@index([gateway_reference])
  @@index([status])
  @@map("payment")
}

model PaymentReversal {
  id          String   @id @db.Char(36)
  payment_id  String   @db.Char(36)
  invoice_id  String   @db.Char(36)
  amount      Float    @db.Float
  reason      String?  @db.VarChar(255)
  created_at  DateTime @default(now()) @db.DateTime(0)
  reversed_by String?  @db.VarChar(100)
  metadata    Json?
  payment     Payment  @relation(fields: [payment_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_reversal_payment")

  @@index([payment_id], map: "idx_payment_id")
  @@map("payment_reversal")
}

model Receipt {
  id        String    @id @default(dbgenerated("(uuid())")) @db.Char(36)
  invoiceId String    @map("invoice_id") @db.Char(36)
  paymentId String    @map("payment_id") @db.Char(36)
  receiptNo String    @unique(map: "receiptNo") @db.VarChar(100)
  issuedOn  DateTime? @default(now()) @db.DateTime(0)
  createdAt DateTime? @default(now()) @db.DateTime(0)
  updatedAt DateTime? @default(now()) @db.DateTime(0)
  invoice   Invoice   @relation(fields: [invoiceId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "receipt_ibfk_1")
  payment   Payment   @relation(fields: [paymentId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "receipt_ibfk_2")

  @@index([invoiceId], map: "invoice_id")
  @@index([paymentId], map: "payment_id")
  @@map("receipt")
}

model utility {
  id            String          @id @default(dbgenerated("(uuid())")) @db.Char(36)
  name          String          @unique(map: "name") @db.VarChar(100)
  type          utility_type
  unitPrice     Float?          @db.Float
  fixedAmount   Float?          @db.Float
  createdAt     DateTime?       @default(now()) @db.DateTime(0)
  updatedAt     DateTime?       @default(now()) @db.DateTime(0)
  lease_utility lease_utility[]
  utilityBills  UtilityBill[]

  @@map("utility")
}

model lease_utility {
  id                    String            @id @default(uuid())
  lease_id              String
  utility_id            String            @db.Char(36)
  is_tenant_responsible Boolean?          @default(true)
  createdAt             DateTime?         @default(now()) @db.DateTime(0)
  updatedAt             DateTime?         @default(now()) @db.DateTime(0)
  Lease                 Lease             @relation(fields: [lease_id], references: [id], onDelete: Cascade)
  utility               utility           @relation(fields: [utility_id], references: [id], onDelete: Cascade)
  utility_reading       utility_reading[]

  @@index([lease_id])
  @@index([utility_id])
  @@map("lease_utility")
}

model utility_reading {
  id               String        @id @default(uuid())
  lease_utility_id String        @db.Char(36)
  reading_value    Float         @db.Float
  readingDate      DateTime?     @default(now()) @db.DateTime(0)
  amount           Float?        @db.Float
  createdAt        DateTime?     @default(now()) @db.DateTime(0)
  updatedAt        DateTime?     @default(now()) @db.DateTime(0)
  lease_utility    lease_utility @relation(fields: [lease_utility_id], references: [id], onDelete: Cascade)

  @@index([lease_utility_id])
  @@map("utility_reading")
}

model DssDocument {
  id                   String                  @id @default(uuid())
  organizationId       String                  @map("organization_id")
  leaseId              String?                 @map("lease_id")
  propertyId           String?                 @map("property_id")
  unitId               String?                 @map("unit_id")
  title                String
  description          String?                 @db.Text
  originalFileUrl      String?                 @map("original_file_url") @db.Text
  originalFileKey      String?                 @map("original_file_key")
  mimeType             String?                 @map("mime_type")
  fileSizeBytes        Int?                    @map("file_size_bytes")
  originalPdfSha256Hex String                  @map("original_pdf_sha256_hex")
  finalPdfSha256Hex    String?                 @map("final_pdf_sha256_hex")
  status               DssDocumentStatus       @default(DRAFT)
  signingMode          DssSigningMode          @default(SEQUENTIAL)
  currentStep          Int                     @default(1) @map("current_step")
  sentAt               DateTime?               @map("sent_at")
  completedAt          DateTime?               @map("completed_at")
  voidedAt             DateTime?               @map("voided_at")
  createdAt            DateTime                @default(now()) @map("created_at")
  updatedAt            DateTime                @updatedAt @map("updated_at")
  notaryRecord         BlockchainNotaryRecord?
  lease                Lease?                  @relation(fields: [leaseId], references: [id])
  organization         Organization            @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  property             Property?               @relation(fields: [propertyId], references: [id])
  unit                 Unit?                   @relation(fields: [unitId], references: [id])
  participants         DssParticipant[]
  signatures           DssSignature[]

  @@index([organizationId])
  @@index([leaseId])
  @@index([propertyId], map: "dss_documents_property_id_fkey")
  @@index([unitId], map: "dss_documents_unit_id_fkey")
  @@map("dss_documents")
}

model DssParticipant {
  id              String             @id @default(uuid())
  documentId      String             @map("document_id")
  organizationId  String             @map("organization_id")
  userId          String?            @map("user_id")
  email           String             @db.VarChar(255)
  fullName        String?            @map("full_name")
  role            DssParticipantRole
  stepOrder       Int                @default(1) @map("step_order")
  hasSigned       Boolean            @default(false) @map("has_signed")
  signedAt        DateTime?          @map("signed_at")
  viewedAt        DateTime?          @map("viewed_at")
  accessTokenHash String?            @map("access_token_hash")
  document        DssDocument        @relation(fields: [documentId], references: [id], onDelete: Cascade)
  organization    Organization       @relation(fields: [organizationId], references: [id])
  user            User?              @relation(fields: [userId], references: [id])
  signatures      DssSignature[]

  @@unique([documentId, email], map: "uq_dss_participant_doc_email")
  @@index([organizationId], map: "dss_participants_organization_id_fkey")
  @@index([userId], map: "dss_participants_user_id_fkey")
  @@map("dss_participants")
}

model DssSignature {
  id            String         @id @default(uuid())
  documentId    String         @map("document_id")
  participantId String         @map("participant_id")
  signatureHash String         @map("signature_hash")
  signedAt      DateTime       @default(now()) @map("signed_at")
  isProxy       Boolean        @default(false) @map("is_proxy")
  onBehalfOf    String?        @map("on_behalf_of")
  document      DssDocument    @relation(fields: [documentId], references: [id], onDelete: Cascade)
  participant   DssParticipant @relation(fields: [participantId], references: [id], onDelete: Cascade)

  @@unique([documentId, participantId], map: "uq_dss_signature_doc_participant")
  @@index([participantId], map: "dss_signatures_participant_id_fkey")
  @@map("dss_signatures")
}

model BlockchainNotaryRecord {
  id              String                 @id @default(uuid())
  organizationId  String                 @map("organization_id")
  documentId      String                 @unique(map: "uq_notary_document") @map("document_id")
  chainId         Int                    @map("chain_id")
  contractAddress String                 @map("contract_address")
  notarizedHash   String                 @map("notarized_hash")
  txHash          String?                @map("tx_hash")
  blockNumber     Int?                   @map("block_number")
  status          BlockchainNotaryStatus @default(PENDING)
  createdAt       DateTime               @default(now()) @map("created_at")
  confirmedAt     DateTime?              @map("confirmed_at")
  document        DssDocument            @relation(fields: [documentId], references: [id], onDelete: Cascade)
  organization    Organization           @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([notarizedHash])
  @@index([organizationId], map: "blockchain_notary_records_organization_id_fkey")
  @@map("blockchain_notary_records")
}

model DssWorkflowTemplate {
  id             String            @id @default(uuid())
  organizationId String            @map("organization_id")
  name           String
  description    String?
  propertyId     String?           @map("property_id")
  createdAt      DateTime          @default(now()) @map("created_at")
  updatedAt      DateTime          @updatedAt @map("updated_at")
  steps          DssWorkflowStep[]
  organization   Organization      @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  property       Property?         @relation(fields: [propertyId], references: [id])

  @@index([organizationId], map: "dss_workflow_templates_organization_id_fkey")
  @@index([propertyId], map: "dss_workflow_templates_property_id_fkey")
  @@map("dss_workflow_templates")
}

model DssWorkflowStep {
  id         String              @id @default(uuid())
  templateId String              @map("template_id")
  stepOrder  Int                 @map("step_order")
  role       DssParticipantRole
  label      String?
  isOptional Boolean             @default(false) @map("is_optional")
  template   DssWorkflowTemplate @relation(fields: [templateId], references: [id], onDelete: Cascade)

  @@unique([templateId, stepOrder])
  @@map("dss_workflow_steps")
}

model Listing {
  id                 String              @id @default(uuid())
  organizationId     String
  createdBy          String
  statusId           String?
  locationId         String?
  title              String
  description        String
  price              Float
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  propertyId         String?
  unitId             String?
  availabilityDate   DateTime?           @map("availability_date")
  expirationDate     DateTime?           @map("expiration_date")
  adminActions       AdminAction[]
  createdByUser      User                @relation(fields: [createdBy], references: [id])
  location           Location?           @relation(fields: [locationId], references: [id])
  organization       Organization        @relation(fields: [organizationId], references: [id])
  status             ListingStatus?      @relation(fields: [statusId], references: [id])
  images             ListingImage[]
  property           Property?           @relation("PropertyListing")
  serviceMarketplace ServiceMarketplace?
  unit               Unit?               @relation("UnitListing")
  auditEntries       ListingAuditEntry[]

  @@index([createdBy])
  @@index([locationId])
  @@index([organizationId])
  @@index([statusId])
}

model ServiceMarketplace {
  id            String            @id @default(uuid())
  listingId     String            @unique
  vendorId      String?
  serviceTypeId String?
  description   String
  rate          Decimal           @db.Decimal(10, 2)
  availability  String?
  createdAt     DateTime          @default(now())
  listing       Listing           @relation(fields: [listingId], references: [id])
  serviceType   ServiceType?      @relation(fields: [serviceTypeId], references: [id])
  vendor        OrganizationUser? @relation(fields: [vendorId], references: [id])

  @@index([serviceTypeId])
  @@index([vendorId])
}

model MaintenanceRequest {
  id                 String                    @id @default(uuid())
  organizationId     String
  propertyId         String
  requestedById      String
  title              String
  description        String
  priority           Priority                  @default(NORMAL)
  status             MaintenanceRequest_status @default(OPEN)
  createdAt          DateTime                  @default(now())
  updatedAt          DateTime                  @updatedAt
  category           RequestCategory           @default(STANDARD)
  unitId             String?
  assigned_vendor_id String?
  cost               Decimal?                  @db.Decimal(10, 2)
  assigned_at        DateTime?                 @db.DateTime(0)
  invoiceId          String?                   @unique @map("invoice_id")
  isTenantChargeable Boolean                   @default(false) @map("is_tenant_chargeable")
  journalEntryId     String?                   @unique @map("journal_entry_id")
  invoice            Invoice?                  @relation(fields: [invoiceId], references: [id])
  journalEntry       JournalEntry?             @relation(fields: [journalEntryId], references: [id])
  organization       Organization              @relation(fields: [organizationId], references: [id])
  property           Property                  @relation("PropertyMaintenanceRequests", fields: [propertyId], references: [id])
  requestedBy        OrganizationUser          @relation("RequestCreator", fields: [requestedById], references: [id])
  unit               Unit?                     @relation(fields: [unitId], references: [id])
  vendors            Vendor?                   @relation(fields: [assigned_vendor_id], references: [id], onUpdate: NoAction, map: "fk_MaintenanceRequest_assignedVendorId")

  @@index([organizationId])
  @@index([propertyId])
  @@index([requestedById])
  @@index([unitId])
  @@index([assigned_vendor_id])
}

model OccupancyHistory {
  id            String   @id
  propertyId    String
  year          Int
  month         Int
  occupancyRate Decimal  @db.Decimal(5, 2)
  createdAt     DateTime @default(now())
  Property      Property @relation(fields: [propertyId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_occupancy_property")

  @@index([propertyId, year, month], map: "idx_occupancy_property_year_month")
}

model AdminAction {
  id              String            @id @default(uuid())
  adminOrgUserId  String
  targetOrgUserId String?
  listingId       String?
  actionTypeId    String
  reason          String?
  details         Json?
  createdAt       DateTime          @default(now())
  actionType      ActionType        @relation(fields: [actionTypeId], references: [id])
  admin           OrganizationUser  @relation("AdminActionsByAdmin", fields: [adminOrgUserId], references: [id])
  listing         Listing?          @relation(fields: [listingId], references: [id])
  target          OrganizationUser? @relation("AdminActionsTarget", fields: [targetOrgUserId], references: [id])

  @@index([actionTypeId])
  @@index([adminOrgUserId])
  @@index([listingId])
  @@index([targetOrgUserId])
}

model CategoryMarketplace {
  id          String   @id @default(uuid())
  name        String   @unique
  description String?
  createdAt   DateTime @default(now())
}

model Location {
  id         String     @id @default(uuid())
  name       String
  city       String?
  country    String?
  createdAt  DateTime   @default(now())
  listings   Listing[]
  properties Property[]
}

model ActionType {
  id           String        @id @default(uuid())
  name         String        @unique
  description  String?
  createdAt    DateTime      @default(now())
  adminActions AdminAction[]
}

model ListingImage {
  id        String   @id @default(uuid())
  listingId String
  imageUrl  String
  isPrimary Boolean  @default(false)
  createdAt DateTime @default(now())
  listing   Listing  @relation(fields: [listingId], references: [id])

  @@index([listingId])
}

model ListingStatus {
  id          String    @id @default(uuid())
  name        String    @unique
  description String?
  createdAt   DateTime  @default(now())
  listings    Listing[]
}

model ServiceType {
  id                 String               @id @default(uuid())
  name               String               @unique
  description        String?
  createdAt          DateTime             @default(now())
  serviceMarketplace ServiceMarketplace[]
}

model categories {
  id       Int        @id @default(autoincrement())
  name     String
  tagline  String
  color    String
  services services[]

  @@map("categories")
}

model services {
  id          Int        @id @default(autoincrement())
  category_id Int
  name        String
  description String
  features    Json
  impact      String
  icon        String
  categories  categories @relation(fields: [category_id], references: [id])

  @@index([category_id])
  @@map("services")
}

model AboutUs {
  id          Int      @id @default(autoincrement())
  section     String
  description String   @db.Text
  createdAt   DateTime @default(now())
  updatedAt   DateTime @default(now())
}

model Applicant {
  id          Int           @id @default(autoincrement())
  firstName   String
  lastName    String
  email       String        @unique
  resume      String?
  createdAt   DateTime      @default(now())
  Application Application[]
}

model Application {
  id          Int       @id @default(autoincrement())
  jobId       Int
  applicantId Int
  status      String    @default("Pending")
  appliedAt   DateTime  @default(now())
  Applicant   Applicant @relation(fields: [applicantId], references: [id])
  Job         Job       @relation(fields: [jobId], references: [id])

  @@index([applicantId])
  @@index([jobId])
}

model CTA {
  id         Int      @id @default(autoincrement())
  page       String
  title      String
  subtitle   String
  buttonText String
  buttonUrl  String
  gradient   String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime
}

model ContactMessage {
  id          Int      @id @default(autoincrement())
  name        String
  email       String
  message     String
  createdAt   DateTime @default(now())
  countryCode String
  phone       String
}

model HeroSection {
  id          Int      @id @default(autoincrement())
  page        String
  title       String?
  subtitle    String?
  description String?
  buttonText  String?
  buttonUrl   String?
  imageUrl    String?
  iconUrl     String?
  searchBar   Boolean  @default(false)
  gradient    String?
  layout      String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime
}

model Job {
  id          Int           @id @default(autoincrement())
  title       String
  description String
  image       String
  createdAt   DateTime      @default(now())
  updatedAt   DateTime
  Application Application[]
}

model Policy {
  id                       Int       @id @default(autoincrement())
  title                    String
  companyName              String
  contactEmail             String
  privacyEmail             String
  website                  String?
  mailingAddress           String?
  responseTime             String?
  inactiveAccountThreshold String?
  createdAt                DateTime  @default(now())
  updatedAt                DateTime
  Section                  Section[]
}

model Section {
  id        Int      @id @default(autoincrement())
  key       String
  title     String
  intro     String?
  content   Json?
  order     Int?
  policyId  Int
  createdAt DateTime @default(now())
  updatedAt DateTime
  Policy    Policy   @relation(fields: [policyId], references: [id])

  @@index([policyId])
}

model Testimonial {
  id        Int      @id @default(autoincrement())
  name      String
  role      String
  image     String
  text      String
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())
}

model Plan {
  id            Int            @id @default(autoincrement())
  name          String
  badge         String?
  monthlyPrice  Float
  yearlyPrice   Float
  description   String?
  gradient      String?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime?      @default(now())
  organizations Organization[]
  features      Feature[]      @relation("PlanFeatures")
  sidebarItems  SidebarItem[]  @relation("SidebarItemPlans")
}

model Feature {
  id           Int           @id @default(autoincrement())
  title        String
  description  String?
  category     String?
  createdAt    DateTime      @default(now())
  icon         String?
  isActive     Boolean       @default(true)
  key          String?       @unique
  path         String?
  updatedAt    DateTime?     @default(now())
  sidebarItems SidebarItem[]
  plans        Plan[]        @relation("PlanFeatures")
}

model SidebarItem {
  id          Int              @id @default(autoincrement())
  label       String
  path        String
  icon        String?
  section     String?
  order       Int?
  badge       String?
  description String?
  isActive    Boolean          @default(true)
  isExternal  Boolean          @default(false)
  target      String?
  featureId   Int?
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  role        SidebarItem_role
  feature     Feature?         @relation(fields: [featureId], references: [id])
  plans       Plan[]           @relation("SidebarItemPlans")

  @@index([featureId])
}

model NavbarItem {
  id          Int          @id @default(autoincrement())
  name        String
  href        String
  order       Int          @default(0)
  isVisible   Boolean      @default(true)
  isAvailable Boolean      @default(true)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  parentId    Int?
  parent      NavbarItem?  @relation("NavbarSubmenu", fields: [parentId], references: [id], onDelete: Cascade)
  children    NavbarItem[] @relation("NavbarSubmenu")

  @@index([parentId])
}

model LeaseAmendment {
  id             String                       @id
  leaseId        String
  amendmentType  LeaseAmendment_amendmentType
  effectiveDate  DateTime                     @db.DateTime(0)
  description    String?                      @db.Text
  changes        Json?
  previousValues Json?
  status         LeaseAmendment_status?       @default(PENDING)
  createdBy      String
  createdAt      DateTime?                    @default(now()) @db.DateTime(0)
  approvedBy     String?
  approvedAt     DateTime?                    @db.DateTime(0)
  executedBy     String?
  executedAt     DateTime?                    @db.DateTime(0)
  documentUrl    String?                      @db.Text
  Lease          Lease                        @relation(fields: [leaseId], references: [id], onDelete: Cascade)

  @@index([leaseId])
  @@index([status])
}

model LeaseAuditLog {
  id          String    @id
  leaseId     String
  action      String    @db.Text
  performedBy String
  performedAt DateTime? @default(now()) @db.DateTime(0)
  changes     Json?
  ipAddress   String?   @db.VarChar(50)
  userAgent   String?   @db.Text
  Lease       Lease     @relation(fields: [leaseId], references: [id], onDelete: Cascade)

  @@index([leaseId])
}

model LeaseDocument {
  id           String                     @id
  leaseId      String
  documentType LeaseDocument_documentType
  fileName     String                     @db.Text
  fileUrl      String                     @db.Text
  fileSize     Int?
  mimeType     String?                    @db.Text
  version      Int?                       @default(1)
  uploadedBy   String
  uploadedAt   DateTime?                  @default(now()) @db.DateTime(0)
  isSigned     Boolean?                   @default(false)
  signedAt     DateTime?                  @db.DateTime(0)
  description  String?                    @db.Text
  Lease        Lease                      @relation(fields: [leaseId], references: [id], onDelete: Cascade)

  @@index([documentType])
  @@index([leaseId])
}

model LeaseNotification {
  id               String                             @id
  leaseId          String
  notificationType LeaseNotification_notificationType
  recipientEmail   String
  recipientRole    String?                            @db.VarChar(20)
  subject          String?                            @db.Text
  message          String?                            @db.Text
  scheduledFor     DateTime                           @db.DateTime(0)
  sentAt           DateTime?                          @db.DateTime(0)
  status           LeaseNotification_status?          @default(PENDING)
  metadata         Json?
  createdAt        DateTime?                          @default(now()) @db.DateTime(0)
  Lease            Lease                              @relation(fields: [leaseId], references: [id], onDelete: Cascade)

  @@index([leaseId])
  @@index([status])
}

model LeaseRenewal {
  id                 String                       @id
  leaseId            String
  renewalType        LeaseRenewal_renewalType
  oldEndDate         DateTime                     @db.DateTime(0)
  newEndDate         DateTime                     @db.DateTime(0)
  oldRentAmount      Float                        @db.Float
  newRentAmount      Float                        @db.Float
  notificationSentAt DateTime?                    @db.DateTime(0)
  tenantResponseAt   DateTime?                    @db.DateTime(0)
  tenantResponse     LeaseRenewal_tenantResponse?
  negotiationNotes   String?                      @db.Text
  executedAt         DateTime?                    @db.DateTime(0)
  executedBy         String?
  status             LeaseRenewal_status?         @default(PENDING)
  createdAt          DateTime?                    @default(now()) @db.DateTime(0)
  Lease              Lease                        @relation(fields: [leaseId], references: [id], onDelete: Cascade)

  @@index([leaseId])
}

model RentEscalation {
  id              String                        @id
  leaseId         String
  effectiveDate   DateTime                      @db.DateTime(0)
  previousRent    Float                         @db.Float
  newRent         Float                         @db.Float
  escalationType  RentEscalation_escalationType
  escalationRate  Float?                        @db.Float
  calculationNote String?                       @db.Text
  appliedAt       DateTime?                     @default(now()) @db.DateTime(0)
  appliedBy       String
  Lease           Lease                         @relation(fields: [leaseId], references: [id], onDelete: Cascade)

  @@index([leaseId])
}

model PropertyType {
  id          String     @id @default(uuid())
  name        String     @unique
  description String?
  createdAt   DateTime   @default(now())
  properties  Property[]
}

model AgentInvite {
  id              String    @id @default(uuid())
  inviteTokenHash String    @unique
  expiresAt       DateTime
  usedAt          DateTime?
  isUsed          Boolean   @default(false)
  tenantId        String
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  tenant          User      @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([expiresAt])
  @@index([tenantId])
}

model ListingAuditEntry {
  id             String              @id @default(uuid())
  unitId         String              @map("unit_id")
  listingId      String?             @map("listing_id")
  action         ListingAction_enum
  previousStatus ListingStatus_enum? @map("previous_status")
  newStatus      ListingStatus_enum  @map("new_status")
  userId         String              @map("user_id")
  timestamp      DateTime            @default(now())
  reason         String?
  metadata       Json?
  createdAt      DateTime            @default(now()) @map("created_at")
  listing        Listing?            @relation(fields: [listingId], references: [id])
  unit           Unit                @relation(fields: [unitId], references: [id], onDelete: Cascade)
  user           User                @relation(fields: [userId], references: [id])

  @@index([unitId])
  @@index([listingId])
  @@index([userId])
  @@index([timestamp])
  @@index([action])
  @@map("listing_audit_entries")
}

model tenant_payment_methods {
  id                       String   @id
  user_id                  String
  type                     String
  plaid_access_token       String?
  plaid_account_id         String?
  stripe_payment_method_id String
  is_default               Boolean  @default(false)
  created_at               DateTime @default(now())
  updated_at               DateTime
  users                    User     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
}

enum Priority {
  LOW
  NORMAL
  HIGH
  URGENT
}

enum RequestCategory {
  EMERGENCY
  URGENT
  ROUTINE
  STANDARD
}

enum UserStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
}

enum ApplicationStatus {
  PENDING
  APPROVED
  REJECTED
  UNDER_REVIEW
}

enum invoice_type {
  RENT
  UTILITY
  MAINTENANCE
  DAMAGE
}

enum utility_type {
  FIXED
  METERED
}

enum payment_method {
  CASH
  BANK
  CREDIT_CARD
  MPESA
  PAYPAL
  STRIPE
  PAYSTACK
  MANUAL
}

enum invoice_status {
  PENDING
  PAID
  OVERDUE
}

enum MaintenanceRequest_status {
  OPEN
  IN_PROGRESS
  ON_HOLD
  COMPLETED
  CANCELLED
  REJECTED
}

enum LeaseAmendment_amendmentType {
  RENT_CHANGE
  TERM_EXTENSION
  UTILITY_CHANGE
  RESPONSIBILITY_CHANGE
  TENANT_CHANGE
  OTHER
}

enum LeaseDocument_documentType {
  LEASE_AGREEMENT
  ADDENDUM
  AMENDMENT
  RENEWAL_NOTICE
  TERMINATION_NOTICE
  INSPECTION_REPORT
  PROOF_OF_INSURANCE
  OTHER
}

enum LeaseRenewal_renewalType {
  AUTO
  MANUAL
  RENEGOTIATED
}

enum RentEscalation_escalationType {
  FIXED
  PERCENTAGE
  INDEX
  MARKET
}

enum LeaseAmendment_status {
  PENDING
  APPROVED
  REJECTED
  EXECUTED
}

enum Lease_leaseStatus {
  DRAFT
  PENDING_APPROVAL
  APPROVED
  SIGNED
  ACTIVE
  EXPIRING_SOON
  EXPIRED
  TERMINATED
  RENEWED
}

enum LeaseNotification_status {
  PENDING
  SENT
  FAILED
  CANCELLED
}

enum LeaseRenewal_tenantResponse {
  ACCEPT
  DECLINE
  NEGOTIATE
  NO_RESPONSE
}

enum LeaseRenewal_status {
  PENDING
  NOTICE_SENT
  TENANT_RESPONDED
  NEGOTIATING
  APPROVED
  EXECUTED
  DECLINED
}

enum Lease_escalationType {
  FIXED
  PERCENTAGE
  INDEX
  MARKET
}

enum Lease_complianceStatus {
  PENDING
  COMPLIANT
  NON_COMPLIANT
  UNDER_REVIEW
}

enum LeaseNotification_notificationType {
  RENEWAL_REMINDER
  EXPIRY_WARNING
  RENT_DUE
  LATE_PAYMENT
  ESCALATION_NOTICE
  COMPLIANCE_CHECK
  DOCUMENT_REQUIRED
  MAINTENANCE_SCHEDULED
  LEASE_SIGNED
  CUSTOM
  AMENDMENT_PROPOSED
  AMENDMENT_EXECUTED
}

enum DssDocumentStatus {
  DRAFT
  SENT
  IN_SIGNING
  COMPLETED
  DECLINED
  VOIDED
  EXPIRED
}

enum DssParticipantRole {
  LANDLORD
  TENANT
  PROPERTY_MANAGER
  AGENT
  VENDOR
  WITNESS
  NOTARY
  CUSTODIAN
  OTHER
}

enum DssSigningMode {
  SEQUENTIAL
  PARALLEL
}

enum BlockchainNotaryStatus {
  PENDING
  SUBMITTED
  CONFIRMED
  FAILED
}

enum UtilitySplitMethod {
  EQUAL
  OCCUPANCY_BASED
  SQ_FOOTAGE
  SUB_METERED
  CUSTOM_RATIO
  AI_OPTIMIZED
}

enum UtilityBillStatus {
  DRAFT
  PROCESSING
  REVIEW_REQUIRED
  APPROVED
  POSTED
  REJECTED
}

enum UtilityImportMethod {
  CSV
  API
  PDF_OCR
  MANUAL_ENTRY
  IMAGE_SCAN
}

enum UtilityAllocationStatus {
  PENDING
  PARTIALLY_PAID
  PAID
  DISPUTED
  VOIDED
}

enum UtilityPaymentMethod {
  ACH
  CARD
  WALLET
  CRYPTO
  BANK_TRANSFER
  CASH
}

enum UtilityReconciliationStatus {
  PENDING
  MATCHED
  FAILED
  MANUAL_REVIEW
}

enum UtilityDisputeStatus {
  OPEN
  UNDER_REVIEW
  RESOLVED
  REJECTED
}

enum AccountType {
  ASSET
  LIABILITY
  EQUITY
  INCOME
  EXPENSE
}

enum PostingStatus {
  DRAFT
  PENDING
  POSTED
  FAILED
  REVERSED
}

enum Invite_role {
  SYSTEM_ADMIN
  PROPERTY_MANAGER
  TENANT
  AGENT
  VENDOR
  ALL
}

enum organization_users_role {
  SYSTEM_ADMIN
  PROPERTY_MANAGER
  TENANT
  AGENT
  VENDOR
  ALL
}

enum OtpType {
  TWO_FACTOR
  PHONE_VERIFICATION
}

enum SidebarItem_role {
  SYSTEM_ADMIN
  PROPERTY_MANAGER
  TENANT
  AGENT
  VENDOR
  ALL
}

enum ListingStatus_enum {
  PRIVATE
  ACTIVE
  SUSPENDED
  PENDING
  EXPIRED
}

enum ListingAction_enum {
  CREATE
  REMOVE
  SUSPEND
  ACTIVATE
  UPDATE
  EXPIRE
}

enum organizations_region {
  USA
  KEN
}

enum payment_gateway {
  STRIPE
  PLAID
  PAYSTACK
  MPESA_DIRECT
  MANUAL
}

enum users_kyc_status {
  PENDING
  VERIFIED
  FAILED
}

enum payment_status {
  PENDING
  AUTHORIZED
  SETTLED
  FAILED
  DISPUTED
  REVERSED
}

enum users_region {
  USA
  KEN
}

enum payment_type {
  RENT
  DEPOSIT
  SAAS_FEE
  MAINTENANCE
}

enum payment_method {
  CASH
  BANK
  CREDIT_CARD
  MPESA
  PAYPAL
  STRIPE
  PAYSTACK
  MANUAL
}

// -------PAYMENT INFRASTRUCTURE ENUMS--------

enum Region {
  USA
  KEN
}

enum KycStatus {
  PENDING
  VERIFIED
  FAILED
}

enum PaymentGateway {
  STRIPE
  PLAID
  PAYSTACK
  MPESA_DIRECT
  MANUAL // for existing cash/bank logic
}

enum TransactionStatus {
  PENDING
  AUTHORIZED
  SETTLED
  FAILED
  DISPUTED
  REVERSED
}

enum TransactionType {
  RENT
  DEPOSIT
  SAAS_FEE
  MAINTENANCE
}
