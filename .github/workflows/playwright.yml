      - name: Ensure manager test user exists (CI)
        shell: bash
        run: |
          node <<'NODE'
          const { PrismaClient } = require('@prisma/client');
          const crypto = require('crypto');
          const prisma = new PrismaClient();

          (async () => {
            const email = 'manager@test.com';

            // CI-only hash for password123 (adjust to your real hashing if you want)
            const passwordHash = crypto
              .createHash('sha256')
              .update('password123')
              .digest('hex');

            const existing = await prisma.user.findUnique({ where: { email } });

            if (!existing) {
              await prisma.user.create({
                data: {
                  email,
                  name: 'Manager Test',
                  passwordHash, // REQUIRED by your schema
                },
              });
              console.log('Created manager@test.com');
            } else {
              console.log('manager@test.com exists');
            }

            // Mark verified if your schema supports it
            try {
              await prisma.user.update({
                where: { email },
                data: { emailVerified: new Date() },
              });
              console.log('Marked manager@test.com as verified');
            } catch {}
          })()
            .catch((e) => { console.error(e); process.exit(1); })
            .finally(async () => { await prisma.$disconnect(); });
          NODE


